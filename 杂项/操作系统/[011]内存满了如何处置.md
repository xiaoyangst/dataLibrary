Linux 处理内存不足的核心逻辑是：**优先回收缓存和不活跃内存 → 使用 Swap 缓冲 → 最后不得已终止进程**。

## 触发内存回收

Linux 的虚拟内存子系统（VM subsystem）会启动 **内存回收线程（kswapd）**，尝试从内存中释放不活跃的页：

- 回收对象：
  - **文件页**：映射到磁盘文件的页（如程序代码、数据文件），可直接从磁盘重新读取，无需写入 Swap。
  - **匿名页：未映射到文件的页（如进程的堆、栈数据），需先写入 Swap 才能回收。
- 回收策略：
  - 通过 **最近最少使用（LRU）算法** 识别冷页（长时间未访问的页）。
  - 优先回收文件页，其次是匿名页（需 Swap 配合）

## 启用 Swap

若物理内存不足且存在 Swap 空间，系统会将匿名页换出到磁盘，可以暂时缓解内存压力，避免直接终止进程。

但是 Swap 的读写速度慢，可能导致系统卡顿（“Swap 颠簸”）。而且若 Swap 空间不足或禁用（如 `swappiness=0`），此步骤受限。

## OOM

若内存回收和 Swap 均无法缓解压力，系统会触发 **Out-Of-Memory（OOM）杀手**，选择一个或多个进程强制终止，释放内存。

- 进程选择策略：
  - 通过 **OOM 评分（oom_score）** 决定终止对象，评分越高越优先被 kill。
  - 评分因素包括：进程占用内存大小、存活时间、是否为系统关键进程（如 `systemd` 会被保护）。
  - 可通过 `/proc/<pid>/oom_score_adj` 调整进程被 kill 的优先级（范围 `-1000` 到 `1000`，负值表示豁免）。
- **常见被终止的进程**：占用内存大、非关键的用户进程（如浏览器、数据库等）。

