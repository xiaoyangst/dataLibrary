当进程访问一个**当前不在内存中的页面**时，就会发生缺页异常。

## 缺页异常的分类

- 懒加载：程序加载时，操作系统通常只将部分必要页面（如代码段初始部分）装入内存，当访问到未加载的页面时触发异常。
- 页面置换到磁盘交换区：内存紧张时，操作系统会通过**页面置换算法**将长时间未使用的页面换出到磁盘。后续再次访问该页面时触发异常。
- 非法访问：比如访问了一个根本没有申请的地址、访问越界、访问空指针（NULL），这种情况下页表根本不含有该虚拟地址的任何项，缺页异常被 OS 捕获后，会判断这是非法访问，通常会终止进程。

## 缺页异常的处理流程

1. **判断访问是否合法**：操作系统检查进程是否有权限访问该地址（对应前面的非法访问）。如果不合法，则抛出**段错误（Segmentation Fault）**，终止进程。

2. **找到页面来源**：

   - 如果是程序首次访问，操作系统可能会从**可执行文件**中加载这页数据；（对应前面的懒加载）

   - 如果是之前换出过的页面，则可能从**交换空间（swap）**中恢复。（对应前面的页面置换带磁盘交换区）

3. **分配物理内存页**：从空闲页框中选一个，或通过页面置换算法（如 LRU）换出一个页面。

4. **把数据从磁盘读入内存页**。

5. **更新页表**：将虚拟地址和新分配的物理地址建立映射，并标记为有效。

6. **重新执行导致异常的指令**：CPU 重试指令，这次内存访问就能成功。

&nbs

注：先分配物理内存页，再把数据加载到内存页中。